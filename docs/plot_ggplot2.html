<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Making figures</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">IDR3002 Course notes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Software
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="installation.html">Installing and starting up R and RStudio</a>
    </li>
    <li>
      <a href="markdown.html">Creating a report using rmarkdown</a>
    </li>
    <li>
      <a href="structure.html">Structuring an analysis</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Lessons
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="introduction_1.html">Introduction to R</a>
    </li>
    <li>
      <a href="import_data.html">Import data</a>
    </li>
    <li>
      <a href="make_summaries.html">Make summaries</a>
    </li>
    <li>
      <a href="plot_ggplot2.html">Create plots with ggplot2</a>
    </li>
    <li>
      <a href="descriptive_statistics.html">Assignment: Descriptive statistics</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="inference.html">Statistical inference</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="regression_models.html">Regression models</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="designs.html">Analyzing trials</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="mixed_models_introduction.html">Repeated measures designs using mixed models</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="statistical_power.html">Sample-size calculations</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="design.html">Experimental design</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ex1_intro.html">Introduction to R and RStudio</a>
    </li>
    <li>
      <a href="ex1_import.html">Import data</a>
    </li>
    <li>
      <a href="ex1_summarise.html">Summarise data</a>
    </li>
    <li>
      <a href="ex1_figures.html">Making figures</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="assignments_week1.html">Week 1</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="faq.html">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Making figures</h1>

</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Another super-power of R is its capabilities to create great figures. We will use <a href="https://ggplot2.tidyverse.org/">ggplot2</a> but R has more plotting systems of winch base R (<a href="https://rstudio-pubs-static.s3.amazonaws.com/84527_6b8334fd3d9348579681b24d156e7e9d.html">see this tutorial</a>, or <a href="http://www.sthda.com/english/wiki/r-base-graphs">this</a> and <a href="https://www.statmethods.net/advgraphs/trellis.html">lattice</a> are the most well described and often used. The choice of using ggplot2 is that it is most intuitive and works well with the <a href="https://www.tidyverse.org/">tidyverse</a>.</p>
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<p>There are several good resources aimed at ggplot2:</p>
<ul>
<li><a href="https://r4ds.had.co.nz/data-visualisation.html">Chapter 4 in R for data science</a></li>
<li><a href="https://ggplot2-book.org/">The ggplot2 book</a></li>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/data-visualization-2.1.pdf">The ggplot2 cheatsheet</a></li>
</ul>
</div>
<div id="learning-objectives" class="section level2">
<h2>Learning objectives</h2>
<p>After this session, you should be able to answer:</p>
<ul>
<li>What are geoms?</li>
<li>What is mapping data to aesthetics?</li>
<li>What are theme components?</li>
</ul>
</div>
<div id="the-ggplot2-system" class="section level2">
<h2>The <code>ggplot2</code> system</h2>
<p>When using the ggplot2 system we can think of the resulting graph as containing data that has been <em>mapped</em> to different shapes, coordinates, colors and sizes. We are using geometric representations to display the data.</p>
<p>We map data using the <code>aes()</code> function inside the <code>ggplot()</code> function. Different geometric representations is added to the plot these are called geoms <code>geom_point()</code> is commonly used.</p>
<p>Differently from piping, we add objects together with the <code>+</code> sign.</p>
<p>The following is a short introduction.</p>
</div>
<div id="building-a-figure" class="section level2">
<h2>Building a figure</h2>
<pre class="r"><code>library(tidyverse)
library(readxl)</code></pre>
<p>We will use the cycling data set in this tutorial. Let’s first plot squat jump performance. We might be interested in the development over time. The ggplot function can be used in the end of a pipe.</p>
<pre class="r"><code>cyclingStudy &lt;- read_excel(&quot;./data/cyclingStudy.xlsx&quot;, na = &quot;NA&quot;) 

cyclingStudy %&gt;%
        select(subject, timepoint, group, sj.max) %&gt;%
        ggplot(aes(x = timepoint, y = sj.max))</code></pre>
<p>The above code gives a plot without geometric representations. The x- and y-axis has values corresponding to the range of values in the data. We can add a geometric representation by adding a geom. Let’s try <code>geom_point()</code>.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, timepoint, group, sj.max) %&gt;%
        ggplot(aes(x = timepoint, y = sj.max)) + geom_point()</code></pre>
<p>The addition of this geom maps the data to points on the graph. Each point represents an observation. There are several problems with this graph, these problems can be thought of as problems due to the fact that we have not formatted the data well and that we have not formatted the graph well.</p>
<p>Most changes can be made in ggplot, but some are more easily understood if we change the data first.</p>
<div id="formatting-factor-variables" class="section level3">
<h3>Formatting factor variables</h3>
<p>The time-point variable is interpreted as a factor variable (read more about factors in <a href="https://r4ds.had.co.nz/factors.html">R for data science, Chapter 15</a>). Factor variables are categorical variables that can be ordered and labelled. This is convenient when making a graph. By modifying the factor variable we can change the way ggplot2 creates the graph, and control what each level of the <code>timepoint</code> variable should be called.</p>
<p>Let’s say that instead of <code>meso1</code>, <code>meso2</code>, <code>meso3</code> and <code>pre</code> we want the graph to read “Pre-training”, “Period 1”, “Period 2” and “Period 3”. We can change this by mutating the <code>timepoint</code> variable before the graph.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Pre-training&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        
        ggplot(aes(x = timepoint, y = sj.max)) + geom_point()</code></pre>
<p>In the above the mutate function is used, we modify <code>timepoint</code> to be a factor using the <code>factor()</code> function. The factor function first takes the variable we want to convert to a factor (or change), then we specify levels of the factor. Levels are the order of the factor, this will transfer to the graph wehere the first level will be plotted first. Second we use the <code>labels =</code> argument which puts labels on each factor.</p>
<p>Often the labels are a bit akward to work with but nice to plot. This is because we might want to have spaces and special signs in there, something that makes it difficult to handle in e.g. filtering functions. So, if we need to change a factor before plotting, do it last in the pipe prior to the ggplot call.</p>
<p>We can look at the factor prior to plotting to see what we have done so far.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Pre-training&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
       print()</code></pre>
<p>The labels can be row-breaks. This is handy when you want to describe a lot in the label in the graph. Let’s say that the first level should read “Prior to training period”. This is a long label and it will probably over plot other aspects of the graph. We can use “\n” as a row break indicator.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        
        ggplot(aes(x = timepoint, y = sj.max)) + geom_point()</code></pre>
</div>
<div id="plotting-summaries-instead-of-all-data" class="section level3">
<h3>Plotting summaries instead of all data</h3>
<p>Sometimes we want to plot summaries of the data instead of all data points. There some geoms that does statistical summaries of the data. <code>geom_boxplot</code> and <code>geom_violin</code> for example. These geoms do not need summary statistics, instead they convert the underlying data to a summary and plot it.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        
        ggplot(aes(timepoint, sj.max))  + geom_boxplot()</code></pre>
<p>Look in the reference under <a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">Computed variables</a> to see what statistics are calculated and plotted.</p>
<p>Another “borderline summary” plotting method is the <code>geom_violin</code>. It adds a dimension to the plot where the width of the geom corresponds to the number of points.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        
        ggplot(aes(timepoint, sj.max))  + geom_violin()</code></pre>
<p>If we want to plot other summary statistics we usually have to compute them prior to plotting.</p>
<p>Let’s say that we want to plot the mean of each group (INCR, DECR, MIX) at each time-point. Then we would first calculate the summary followed by plotting.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
        
        ggplot(aes(timepoint, sj.max))  + geom_point()</code></pre>
<p>I’ve added the group variable in the select call and made a <code>group_by()</code>/<code>summarise()</code> to calculate the mean. I called the new mean variable the same (<code>sj.max</code>). Each point now represents the mean of each group. Let’s remove the plotting and examine the underlying data.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
        print()</code></pre>
<p>The factor variable <code>timepoint</code> and the <code>group</code> variable exists in a new data frame, <code>sj.max</code> represents the mean.</p>
<p>Since have not mapped the <code>group</code> variable to data, it is impossible to see in the graph what group corresponds to what point. We need to add aesthetics to make this happen. Let’s add different colors to different groups.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
        ggplot(aes(timepoint, sj.max, color = group))  + geom_point()</code></pre>
<p>The above code maps group to color. We get a legend in the graph telling us about the grouping of the data. Another nice thing to do is to connect the dots to be able to look at development over time. We can do this by adding <code>geom_line()</code>.</p>
<p>However, we will need some extra information in the <code>aes()</code> call. Let’s try</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
        ggplot(aes(timepoint, sj.max, color = group))  + geom_point()  + geom_line()</code></pre>
<p>The warning message should say that “each group consists of only one observation”, this is because we have not told ggplot the kind of grouping we want. Right now ggplot draws a line per time point per group resulting in no line. We can add <code>group = group</code> in <code>aes()</code>.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
        ggplot(aes(timepoint, sj.max, color = group, group = group))  + geom_point()  + geom_line()</code></pre>
<p>Let’s say that we want another statistic, the standard deviation represented in the graph. We can first calculate it in the pipe.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
        print()</code></pre>
<p>Notice that I add the <code>sd()</code> function first as I call the mean the same thing as the variable we calculate the SD from. Placing them in the in the reveresed order would mean that we calculate SD from on the mean (only one number would result in a NA).</p>
<p>The SD can now be mapped to the graph. Let’s try something crazy, by using size in <code>aes()</code></p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group, size = sd.sj.max))  + geom_point()  + geom_line()</code></pre>
<p>The standard deviation is now mapped to size which control the size of both the points and lines. This is <strong>not a common procedure</strong>. To remove an aesthetic from a geom we can specify aes inside that specific geom. Let’s say we want to keep size on the points but remove it on the lines. The we would set <code>size = NULL</code> in the <code>geom_line()</code> like this:</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group, size = sd.sj.max))  + 
        geom_point()  +
        geom_line(aes(size = NULL))</code></pre>
<p>Now only the points has the SD mapped to them. As mentioned above, mapping the SD to size is not something you wold normally do as the scale do not correspond to the scale on the y axis. Instead we would like to use error bars.</p>
<p>Error bars can be added to the plot by using another geom, <code>geom_errorbar()</code>. This geom need some extra information in <code>aes()</code>, <code>ymin</code> and <code>ymax</code> which tells ggplot to map something to each error bar. Let’s map the standard deviation to <span class="math inline">\(\pm\)</span> the mean.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max)) +
        geom_point()  +
        geom_line()</code></pre>
<p>The distance from the mean to the top and bottom of the error bars represents a standard deviation, nice! However the plot is “over plotted” a lot of data on top of each other.</p>
<p>We can do a lot to remedy the situation. Let’s start by moving the data just a little bit. We can control the position of geoms by adding information to the <code>position =</code> argument inside each geom. In this situation we would use the <code>position_dodge()</code>function with a with or let’s say 0.2. Notice that this argument has to be present in all geoms.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2)) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2))</code></pre>
<p>Now each group gets “dodged” to the side. With the middle group (INCR) in the middle. This also changed the behavior of the error-bars. We can tweak the width of the error bars by adding a <code>width =</code> argument.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2))</code></pre>
</div>
<div id="changing-labels" class="section level3">
<h3>Changing labels</h3>
<p>Labels describes axes and plots. See the help file <code>?labs</code> for the <code>labs()</code> function. Using this function we can add labels on all aesthetics, this means that the x- and y-axis labels can be modified together with e.g. size and color.</p>
<p>Let’s modify the axis labels in the previous plot. We do this by adding <code>labs()</code> to the plot.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2)) +
        labs(x = &quot;Time-point&quot;, y = &quot;Squat jump (cm)&quot;)</code></pre>
<p>The aesthetic color can also be modified, the name in the above plot is “group” as the name of the variable we mapped onto color was <code>group</code>. We can change the name of the legend by using <code>labs()</code></p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2)) +
        labs(x = &quot;Time-point&quot;, y = &quot;Squat jump (cm)&quot;, color = &quot;Group&quot;)</code></pre>
<p>We can also add a title, subtitle and caption to the graph.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2)) +
        labs(x = &quot;Time-point&quot;, y = &quot;Squat jump (cm)&quot;, color = &quot;Group&quot;,
             title = &quot;Squat jump height per group&quot;, 
             subtitle = &quot;Different patterns per group&quot;, 
             caption = &quot;Values are mean and SD&quot; )</code></pre>
</div>
<div id="modifying-theme-components" class="section level3">
<h3>Modifying theme components</h3>
<p>A ggplot has theme components, these are appearances of the graph that are not used to map data to. For example the background color of the plot or the size of labels. These components can be modified in the <code>theme()</code> function. There are some pre-made themes, these are <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">listed here</a>. A nice one is <code>theme_bw()</code>. We can add it to the plot.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2)) +
        labs(x = &quot;Time-point&quot;, y = &quot;Squat jump (cm)&quot;, color = &quot;Group&quot;,
             title = &quot;Squat jump height per group&quot;, 
             subtitle = &quot;Different patterns per group&quot;, 
             caption = &quot;Values are mean and SD&quot; ) +
        theme_bw()</code></pre>
<p>If we still want to modify components of the theme we need to specify changes in the <code>theme()</code> function. Parameters that are possible to change are <a href="https://ggplot2.tidyverse.org/reference/theme.html">listed here</a>. All components of a theme are changed based on their <code>theme_element</code>. A theme element can be text, as for example labels, these can be modified with <code>element_text()</code>.</p>
<p>Let’s make the text bigger of the axis labels.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2)) +
        labs(x = &quot;Time-point&quot;, y = &quot;Squat jump (cm)&quot;, color = &quot;Group&quot;,
             title = &quot;Squat jump height per group&quot;, 
             subtitle = &quot;Different patterns per group&quot;, 
             caption = &quot;Values are mean and SD&quot; ) +
        theme_bw() +
        theme(axis.title = element_text(size = 14))</code></pre>
<p>The background of the plot is modified using another theme element as this is not text.</p>
<pre class="r"><code>cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2)) +
        labs(x = &quot;Time-point&quot;, y = &quot;Squat jump (cm)&quot;, color = &quot;Group&quot;,
             title = &quot;Squat jump height per group&quot;, 
             subtitle = &quot;Different patterns per group&quot;, 
             caption = &quot;Values are mean and SD&quot; ) +
        theme_bw() +
        theme(plot.background = element_rect(fill = &quot;gray80&quot;))</code></pre>
<p>Basically all components can be modified with its specific theme component function. See the <a href="https://ggplot2.tidyverse.org/reference/theme.html">reference page</a> for more information.</p>
</div>
<div id="saving-the-plot" class="section level3">
<h3>Saving the plot</h3>
<p>Saving a plot can be done from R Studio by clicking “export” in the plot tab. We can also use the <code>ggsave()</code> function.</p>
<p>We first need to make the plot an object and then specify arguments to decide what file type and size we want the saved image to be.</p>
<pre class="r"><code># Savining the figure as an object &quot;figure1&quot;
figure1 &lt;- cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2)) +
        labs(x = &quot;Time-point&quot;, y = &quot;Squat jump (cm)&quot;, color = &quot;Group&quot;,
             title = &quot;Squat jump height per group&quot;, 
             subtitle = &quot;Different patterns per group&quot;, 
             caption = &quot;Values are mean and SD&quot; ) +
        theme_bw() +
        theme(plot.background = element_rect(fill = &quot;gray80&quot;))

# Savining the figure to disk with ggsave

ggsave(&quot;./output/figure1.png&quot;, plot = figure1)</code></pre>
<p>Saving a .png file as in the example above is not suitable for publication or your master thesis, there you should aim for vector graphics such as a pdf file. <code>ggsave</code> can create a pdf file also.</p>
<pre class="r"><code>ggsave(&quot;./output/figure1.pdf&quot;, plot = figure1)</code></pre>
<p>Although this might need some tweeking of your software.</p>
<p>To create the figure in real life, I would do it in a new R-script and name the script <code>figure1.R</code>. This script would be fully self contained, meaning that all code needed to create the graph is in the script. The script ends with the ggsave function. The script could look like this:</p>
<pre class="r"><code>## Figure 1
# This scripts creates and saves Figure 1 in &quot;./output/figure1.pdf&quot;

# Load packages 
library(tidyverse)
library(readxl)


# load data 
cyclingStudy &lt;- read_excel(&quot;./data/cyclingStudy.xlsx&quot;, na = &quot;NA&quot;)


# Savining the figure as an object &quot;figure1&quot;
figure1 &lt;- cyclingStudy %&gt;%
        select(subject, group, timepoint, group, sj.max) %&gt;%
        
        mutate(timepoint = factor(timepoint, 
                                  levels = c(&quot;pre&quot;, &quot;meso1&quot;, &quot;meso2&quot;, &quot;meso3&quot;),
                                  labels = c(&quot;Prior to\ntrainining\nperiod&quot;, &quot;Period 1&quot;, &quot;Period 2&quot;, &quot;Period 3&quot;))) %&gt;%
        group_by(timepoint, group) %&gt;%
        summarise(sd.sj.max = sd(sj.max, na.rm = TRUE),
                  sj.max = mean(sj.max, na.rm = TRUE)) %&gt;%
         ggplot(aes(timepoint, sj.max, color = group, group = group))  + 
        geom_errorbar(aes(ymin = sj.max - sd.sj.max, 
                          ymax = sj.max + sd.sj.max), 
                      position = position_dodge(width = 0.2), 
                      width = 0.1) +
        geom_point(position = position_dodge(width = 0.2))  +
        geom_line(position = position_dodge(width = 0.2)) +
        labs(x = &quot;Time-point&quot;, y = &quot;Squat jump (cm)&quot;, color = &quot;Group&quot;,
             title = &quot;Squat jump height per group&quot;, 
             subtitle = &quot;Different patterns per group&quot;, 
             caption = &quot;Values are mean and SD&quot; ) +
        theme_bw() +
        theme(plot.background = element_rect(fill = &quot;gray80&quot;))

# Savining the figure to disk with ggsave
ggsave(&quot;./output/figure1.png&quot;, plot = figure1)

# End of script</code></pre>
<p>An alternative is to add the figure to a R Markdown document. If you are creating a pdf from R Markdown you can add a figure caption in the code-chunk. Read more <a href="https://bookdown.org/yihui/rmarkdown/pdf-document.html">about this here</a>.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
